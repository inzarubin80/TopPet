# Настройка таймаутов для загрузки файлов

## Проблема 502 Bad Gateway при загрузке видео

Если при загрузке видео возникает ошибка `502 Bad Gateway`, это обычно означает, что таймауты слишком короткие для больших файлов.

## Что было исправлено

### 1. Таймауты сервера (Go)

В `Server/internal/app/app.go`:
- `readTimeoutSeconds`: увеличен с 60 до 600 секунд (10 минут)
- `writeTimeoutSeconds`: увеличен с 60 до 600 секунд (10 минут)

В `Server/internal/app/context/context.go`:
- `UploadTimeout`: увеличен с 5 до 10 минут

### 2. Обработчики загрузки

В `Server/internal/app/http/upload_video.go` и `upload_photo.go`:
- Добавлено использование `WithUploadTimeout` для увеличенного таймаута контекста

### 3. Таймауты клиента (React)

В `client/src/api/participantsApi.ts`:
- `uploadVideo`: добавлен таймаут 600000 мс (10 минут)
- `uploadPhoto`: добавлен таймаут 300000 мс (5 минут)

## Настройки Coolify

Важно также проверить настройки таймаутов в Coolify:

### Для приложения Server (API):

1. Откройте настройки приложения Server в Coolify
2. Перейдите в раздел "Advanced" или "Resource Limits"
3. Проверьте/установите:
   - **Proxy Timeout**: минимум 600 секунд (10 минут)
   - **Request Timeout**: минимум 600 секунд (10 минут)
   - **Client Max Body Size**: минимум 100MB (или больше, если нужно)

### Альтернативный способ (через переменные окружения):

Если Coolify поддерживает настройку через переменные окружения, можно добавить:
- `PROXY_READ_TIMEOUT=600`
- `PROXY_SEND_TIMEOUT=600`
- `CLIENT_MAX_BODY_SIZE=100m`

## Проверка

После применения изменений:

1. Пересоберите и перезапустите сервер
2. Пересоберите и перезапустите клиент
3. Попробуйте загрузить видео файл
4. Проверьте логи сервера на наличие ошибок таймаута

## Рекомендации

- Для файлов до 50MB: таймауты 5 минут обычно достаточно
- Для файлов до 100MB: таймауты 10 минут рекомендуется
- Для больших файлов: рассмотрите возможность использования прямых загрузок в S3 через presigned URLs
